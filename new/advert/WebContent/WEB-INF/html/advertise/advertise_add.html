#@layout()
#define main()

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>广告管理系统</h2>
        <ol class="breadcrumb">
            <li>
                <a href="toMain">主页</a>
            </li>
            <li>
                <strong>新增广告</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2"></div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="ibox-content">
        <form  action="/advert/advertise/insert"  name="add" method="post" role="form" class="form-horizontal">
            <legend>新增广告信息</legend>

            <div class="form-group">
                <label class="col-sm-3 control-label">频道端口：</label>
                <div class="col-sm-7">
                    <select class="form-control" required="required" id="port">
                        <option value="APP">APP</option>
                        <option value="PC">PC</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">频道：</label>
                <div class="col-sm-7">
                    <select class="form-control" required="required" id="channel">

                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">广告位：</label>
                <div class="col-sm-7">
                    <!-- <input type="text" maxlength="2" class="form-control" id="pl_id" name="pl_id" required="required" placeholder="广告位为纯数字"> -->
                    <select class="form-control" required="required" id="place" name="ad_place">

                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">投放区域：</label>
                <div class="col-sm-7 row">
                    <div class="col-sm-4">
                        <select class="form-control" required="required"  id="province">
                            <option value="">====省===</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <select class="form-control" id="city">
                            <option value="">===市===</option>
                        </select>
                    </div>
                    <div class="col-sm-4">
                        <select class="form-control" id="country">
                            <option>===县===</option>
                        </select>
                    </div>
                    <input type="hidden" class="form-control" value="全国" name="ad_region" id="region">
                    <input type="hidden" class="form-control" value="00" name="ad_code" id="code">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label" for="title">广告标题：</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" id="title" required="required" name="ad_title" placeholder="请输入广告标题">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label" for="brief">广告描述：</label>
                <div class="col-sm-7">
                    <input  id="brief" class="form-control" rows="1" required="required" name="ad_brief">
                </div>
            </div>



            <div class="form-group">
                <label class="col-sm-3 control-label">广告类型：</label>
                <div class="col-sm-7">
                    <select class="form-control" required="required" name="ad_type" id="type">
                        <option value="1">商品</option>
                        <option value="2">商家-日用百货</option>
                        <option value="3">商家-餐饮美食</option>
                        <option value="4">商家-酒店住宿</option>
                        <option value="5">商家-其他</option>
                        <option value="6">活动</option>
                        <option value="7">导航</option>
                        <option value="8">图片</option>
                        <option value="9">文字</option>
                        <option value="10">商家搜索(餐饮)</option>
                        <option value="11">商家搜索</option>
                        <option value="12">商家搜索(售物)</option>
                    </select>
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-3 control-label" for="val">链接地址：</label>
                <div class="col-sm-7">
                    <input type="text" class="form-control" required="required" name="ad_value" id="val" placeholder="请输入链接地址">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label" for="val">排序位：</label>
                <div class="col-sm-7">
                    <input type="number" class="form-control" required="required" name="ad_sort" id="sort">
                </div>
            </div>


            <div class="form-group">
                <label class="col-sm-3 control-label">图片名称：</label>
                <div class="col-sm-7">
                    <div>
                    <input type="text" class="form-control"  id="filename" placeholder="请输入图片名称" name="ad_pic">
                    </div>
                    <ul class="auto_completion_content" id="flieinfo">

                    </ul>
                   <!-- <input type="hidden" id="flie" name="ad_pic">-->
                </div>
            </div>
            <input type="submit" class="btn btn-primary"/>
        </form>
    </div>
</div>



<!-- Mainly scripts -->
<script src="#(ctx)/static/js/jquery-2.1.1.min.js"></script>
<script src="#(ctx)/static/js/bootstrap.min.js"></script>
<script src="#(ctx)/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<!-- Data Tables -->
<script src="#(ctx)/static/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="#(ctx)/static/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<!-- Custom and plugin javascript -->
<script src="#(ctx)/static/js/hplus.js?v=2.2.0"></script>
<script src="#(ctx)/static/js/plugins/pace/pace.min.js"></script>
<!-- layer javascript
<script src="#(ctx)/static/js/plugins/layer/layer.min.js"></script>-->

<!-- Custom and plugin javascript -->

<script src="#(ctx)/static/js/plugins/switchery/switchery.js"></script>
<!-- upload -->
<script src="#(ctx)/static/js/fileinput.js" type="text/javascript"></script>



<style>
    *{
        padding: 0;
        margin: 0;
        font-family: "微软雅黑";
    }
    .auto_completion{
        position: relative;
    }
    .auto_completion_content{
        overflow-y: auto;
        height: 261px;
    }
    .auto_completion_content li{
        padding: 10px 0;
        cursor: pointer;
        border-bottom: 1px solid #e0e0e0;
        overflow: hidden;
        zoom:1;
    }
    .auto_completion_content li:hover{
        background-color: #fafafa;
    }
    .auto_completion_content li span{
        display: inline-block;
        line-height: 60px;
        margin-left: 10px;
    }
    .auto_completion_content img{
        height: 60px;
        border:1px solid #E0E0E0;
        padding: 2px;
        float: left;
        width: 60px;
    }
</style>

<script>
    //获取频道
    function port(){
        //获取频道端口
        var port=$('#port').val();
        $.ajax({
            type: "GET",
            url: "/advert/advertise/findchannel",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data:{"port":port},
            async: false,
            success:function(data){
                $("#channel").empty();
                if (data.length==0){
                    $("#channel").append("<option value=''>此端口下暂无频道</option>");
                }
                for (var i=0;i<data.length;i++){
                    $("#channel").append("<option value='"+data[i].id+"'>"+data[i].ch_title+"</option>");
                }
            }
        });
    };

    //获取广告位
    function findplace(){
        //获取频道id
        var channelid=$('#channel').val();
        $.ajax({
            type: "GET",
            url: "/advert/advertise/findplace",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data:{"channelid":channelid},
            async: false,
            success:function(data){
                $("#place").empty();
                if (data.length==0){
                    $("#place").append("<option value=''>此频道下无广告位</option>");
                }
                for (var i=0;i<data.length;i++){
                    $("#place").append("<option value='"+data[i].id+"'>"+data[i].pl_title+"</option>");
                }
            }
        });

    }


    //修改跳转链接地址
    function updateval(){
        //获取type类型
        var val="";
        switch ($('#type').val()){
            case '1':
                val="manjiwang://push/goodsdetail?articleid=";
                break;
            case '2':
               val="manjiwang://push/shopdetail?shoptype=1&shopid=";
                break;
            case '3':
                val="manjiwang://push/shopdetail?shoptype=2&shopid=";
                break;
            case '4':
                val="manjiwang://push/shopdetail?shoptype=3&shopid=";
                break;
            case '5':
                val="manjiwang://push/shopdetail?shoptype=4&shopid=";
                break;
            case '6':
                val="manjiwang://push/web?url=";
                break;
            case '10':
                val="manjiwang://push/searchshop?key=";
                break;
            case '11':
                val="manjiwang://push/searchgoods?type=goods&key=";
                break;
            case '12':
                val="manjiwang://push/searchgoods?type=shops&key=";
                break;
            default:
                val="";
        }
        $('#val').val(val);
    }



    //通过图片名称搜索图片
    function findfile(){
        //获取图片名称
        var filename=$("#filename").val();
        if (filename==""){
            $("#flieinfo").empty();
            return;
        }
        $.ajax({
            type: "GET",
            url: "/advert/advertise/findfile",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data:{"filename":filename},
            async: false,
            success:function(data){
                $("#flieinfo").empty();
                var txt="";
                for (var i=0;i<data.length;i++){
                   txt+="<li onclick='clickimginfo(this)'> <img src='"+data[i].file_address+"'/> <span>"+data[i].file_address+"</span> </li><input type='hidden' value='"+data[i].id+"'/>"
                }
                $("#flieinfo").append(txt);
            }
        })
    }


    $(document).ready(function () {
        updateval();
        firstregion();
        port();
        findplace();
        $('#port').change(function(){
            port();
            findplace();
        });
        $('#channel').change(function(){
            findplace();
        });
        $('#province').change(function(){
            secondregion();
            thirdregion();
            var region=$("#province").find("option:selected").text();
            var code=$("#province").val();
            $('#region').val(region);
            $('#code').val(code);
        })
        $('#city').change(function(){
            thirdregion();
            var region=$("#province").find("option:selected").text()+$("#city").find("option:selected").text();
            var code=$("#city").val();
            $('#region').val(region);
            $('#code').val(code);
        })

        $('#country').change(function(){
            var region=$("#province").find("option:selected").text()+$("#city").find("option:selected").text()+$("#country").find("option:selected").text();
            var code=$("#country").val();
            $('#region').val(region);
            $('#code').val(code);
        })

        $('#type').change(function(){
            updateval();
        });
        //图片框处理
        $('#filename').keyup(function(){
            setTimeout(findfile(),1000);
        });

    })

    function clickimginfo(data){
        //图片id $(data).next().val()
        $('#filename').val($(data).find('span').html());
        $("#flieinfo").empty();
    }

    /**
     * 城市联动模块JS
     */
    function secondregion(){
        if ($("#province").val()=='00'){
            $("#city").empty();
            $("#city").append('<option value="">===市===</option>');
            $("#city").val('');
            $("#country").empty();
            $("#country").append('<option value="">===县===</option>');
            $("#country").val('');
            return;
        }
        var ajaxdatas ="code="+$("#province").val();
        $.ajax({
            type : "GET",
            url : "/advert/advertise/secondRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            data:ajaxdatas,
            async: false,
            success : function(data) {
                if(data.code=="0000"){
                    $("#city").empty();
                    var list =data.data;
                    $("#city").append('<option value="">===市===</option>');
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#city").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };
    function thirdregion(){
        var ajaxdatas ="code="+$("#city").val();
        $.ajax({
            type : "GET",
            url : "/advert/advertise/thirdRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            data:ajaxdatas,
            async: false,
            success : function(data) {

                if(data.code=="0000"){
                    $("#country").empty();
                    $("#country").append('<option value="">===县===</option>');
                    var list =data.data;
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#country").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };
    function firstregion(){

        $.ajax({
            type : "GET",
            url : "/advert/advertise/firstRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            async: false,
            success : function(data) {

                if(data.code=="0000"){
                    $("#province").empty();
                    var list =data.data;
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#province").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };




</script>



#end