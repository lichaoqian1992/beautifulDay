#@layout() 
#define main()

 <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
          <h2>广告列表</h2>
          <ol class="breadcrumb">
            <li>
              <a href="toMain">主页</a>
            </li>
            <li>
              <a href="#">广告管理</a>
            </li>
            <li>
              <strong>广告列表</strong>
            </li>
          </ol>
        </div>
        <div class="col-lg-2"></div>
      </div>
            
            
            
             <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row adds-header ibox-content form-horizontal">
          
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" for="state">广告状态：</label>
              <div class="col-sm-6">
                <select id="state" class="form-control">
                  <option value="">不限</option>
                  <option value="1">开启</option>
                  <option value="0">关闭</option>
                </select>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" for="type">广告类型：</label>
              <div class="col-sm-6">
               <!--  -->
               <select id="type" class="form-control" >
                  <option value="">不限</option>
                  <option value="1">商品</option>
                  <option value="2">商家-日用百货</option>
                  <option value="3">商家-餐饮美食</option>
                  <option value="4">商家-酒店住宿</option>
                  <option value="5">商家-其他</option>
                  <option value="6">活动</option>
                  <option value="7">导航</option>
                  <option value="8">图片</option>
                  <option value="9">文字</option>
                </select>
               
               
              </div>
            </div>
          </div>
          
          
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" for="title">广告标题：</label>
              <div class="col-sm-6">
                <input type="text"  class="form-control" id="title" placeholder="广告标题"> 
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" >频道端口：</label>
              <div class="col-sm-6">
                <select class="form-control" required="required" id="port">
                  <option value="">不限</option>
                  <option value="APP">APP</option>
                 <option value="PC">PC</option>
                </select>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" for="channel">频道：</label>
              <div class="col-sm-6">
                <select id="channel" class="form-control">
                  <option value="">不限</option>
                </select>
             
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="col-sm-4 control-label" for="place">广告位：</label>
              <div class="col-sm-6">
                <select id="place" class="form-control">
                  <option value="">不限</option>
                </select>
              </div>
            </div>
          </div>
          <div class="col-sm-8">
            <div class="form-group">
              <label class="col-sm-2 control-label">投放区域：</label>
              <div class="col-sm-10 row">
                <div class="col-sm-4">
                  <select class="form-control" required="required" id="province">
                    <option value="">====省===</option>
                  </select>
                </div>
                <div class="col-sm-4">
                  <select class="form-control" id="city">
                    <option value="">===市===</option>
                  </select>
                </div>
                <div class="col-sm-4">
                  <select class="form-control" id="country">
                    <option value="">===县===</option>
                  </select>
                </div>
                <input type="hidden" class="form-control" name="code" id="code">
              </div>
            </div>
          </div>
          <div class="col-sm-2 col-sm-offset-1">
            <button class="btn btn-primary" id="search" onclick="query(1)">查询</button>
          </div>
        </div>
        <div class="row adds-list ibox-content">
            
        </div>
                 <!--页码-->
                 <div class="row adds-header ibox-content form-horizontal">
                     <div class="pull-left">
                         <span id="pageInfo"></span>
                         <input class="page_number" type="text" value="1" id="toPage" style="width:48px;height: 34px; text-align: center; border:1px solid #31AD8B; border-radius:4px;"/>&nbsp
                         <button class="btn btn-primary pull-right" onclick="toPage()">GO</button>
                     </div>
                     <div class="pull-right">
                         <input id="firstPage" type="hidden"/>
                         <input id="nowPage" type="hidden"/>
                         <input id="lastPage" type="hidden"/>
                         <a class="page_btn btn btn-primary" onclick="firstPage()">首页</a>
                         <a class="page_btn btn btn-primary" onclick="upPage()">上一页</a>
                         <a class="page_btn btn btn-primary" onclick="nextPage()">下一页</a>
                         <a class="page_btn btn btn-primary" onclick="lastPage()">尾页</a>
                     </div>
                 </div>
      </div>

    <!--详情窗-->
<div class="modal fade" id="showDetail">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="row">
                    <div class="col-sm-7 pull-left"><h4 class="modal-title">广告详情</h4></div>
                    <div class="col-sm-2 pull-right">
                        <button type="button" class="btn btn-info btn-xs" id="adds-update">修改</button>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <form action="" method="POST" role="form" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">标题：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="title_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">描述：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="brief_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">投放地区：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="region_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">终端：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="channel_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">广告位：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="pl_id_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">状态：</label>
                        <div class="col-sm-7">
                            <input type="checkbox" class="stateCheck" id="switchery" checked="true" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">类型：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="type_detail" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">排序位：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="sort" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">点击次数：</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="count_detail" disabled>
                        </div>
                    </div>

                    <div class="pic-box form-group">

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

    <!--修改窗-->
    <div class="modal fade" id="showUpdate">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">修改广告</h4>
                </div>
                <div class="modal-body" style="height:650px;overflow-y: scroll;">
                    <form  action="/advert/advertise/updAdds" method="POST" role="form" id="updateForm" class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">标题：</label>
                            <div class="col-sm-7">
                                <input type="text" name="ad_title" class="form-control" id="title_update">
                                <input type="hidden" name="id" id="addsId">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">描述：</label>
                            <div class="col-sm-7">
                                <input type="text" name="ad_brief" class="form-control" id="brief_update">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">投放地区：</label>
                            <div class="col-sm-9 row" style="margin-left: -15px;">
                                <div class="col-sm-4">
                                    <select class="form-control" id="province1">

                                    </select>
                                </div>
                                <div class="col-sm-4">
                                    <select class="form-control" id="city1">

                                    </select>
                                </div>
                                <div class="col-sm-4">
                                    <select class="form-control" id="country1">

                                    </select>
                                </div>
                                <input type="hidden" name="ad_code" id="code-update">
                                <input type="hidden" name="ad_region" id="region-update">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">频道端口：</label>
                            <div class="col-sm-7">
                                <select name="port" class="form-control" id="port_update">
                                    <option value="APP">APP</option>
                                    <option value="PC">PC</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">频道：</label>
                            <div class="col-sm-7">
                                <select name="channel" class="form-control" id="channel_update">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">广告位：</label>
                            <div class="col-sm-7">
                                <select  name="ad_place" class="form-control" id="pl_id_update">

                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">类型：</label>
                            <div class="col-sm-7">
                                <select  name="ad_type" class="form-control" id="type_update">
                                    <option value="1">商品</option>
                                    <option value="2">商家-日用百货</option>
                                    <option value="3">商家-餐饮美食</option>
                                    <option value="4">商家-酒店住宿</option>
                                    <option value="5">商家-其他</option>
                                    <option value="6">活动</option>
                                    <option value="7">导航</option>
                                    <option value="8">图片</option>
                                    <option value="9">文字</option>
                                    <option value="10">商家搜索(餐饮)</option>
                                    <option value="11">商家搜索</option>
                                    <option value="12">商家搜索(售物)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">链接地址：</label>
                            <div class="col-sm-7">
                                <input type="text" name="ad_value" class="form-control" id="val_update">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">排序位：</label>
                            <div class="col-sm-7">
                                <input type="number" name="ad_sort" class="form-control" id="sort_update">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">修改图片：</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control"  id="filename" placeholder="请输入图片名称" name="ad_pic">
                            </div>
                            <ul class="auto_completion_content" id="flieinfo">

                            </ul>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="$('#updateForm').submit()">提交</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Mainly scripts -->
    <script src="#(ctx)/static/js/jquery-2.1.1.min.js"></script>
    <script src="#(ctx)/static/js/bootstrap.min.js"></script>
    <script src="#(ctx)/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <!-- Data Tables -->
    <script src="#(ctx)/static/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="#(ctx)/static/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <!-- Custom and plugin javascript -->
    <script src="#(ctx)/static/js/hplus.js?v=2.2.0"></script>
    <script src="#(ctx)/static/js/plugins/pace/pace.min.js"></script>
    <!-- layer javascript
    <script src="#(ctx)/static/js/plugins/layer/layer.min.js"></script>-->
    
  <!-- Custom and plugin javascript -->

  	<script src="#(ctx)/static/js/plugins/switchery/switchery.js"></script>
  <!-- upload -->
  	<script src="#(ctx)/static/js/fileinput.js" type="text/javascript"></script>

<style>
    *{
        padding: 0;
        margin: 0;
        font-family: "微软雅黑";
    }
    .auto_completion{
        position: relative;
    }
    .auto_completion_content{
        overflow-y: auto;
        height: 261px;
    }
    .auto_completion_content li{
        padding: 10px 0;
        cursor: pointer;
        border-bottom: 1px solid #e0e0e0;
        overflow: hidden;
        zoom:1;
    }
    .auto_completion_content li:hover{
        background-color: #fafafa;
    }
    .auto_completion_content li span{
        display: inline-block;
        line-height: 60px;
        margin-left: 10px;
    }
    .auto_completion_content img{
        height: 60px;
        border:1px solid #E0E0E0;
        padding: 2px;
        float: left;
        width: 60px;
    }
</style>
		
  <script>
      //分页
      //点击首页
      function firstPage(){
          if(1 == $("#nowPage").val()){
              layer.msg('已经是第一页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          query(1);
      }
      //点击上一页
      function upPage(){
          var page = $("#nowPage").val()*1-1;
          if(page<1){
              layer.msg('已经是第一页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          query(page);
      }
      //点击下一页
      function nextPage(){
          var page = $("#nowPage").val()*1+1;
          if(page>$("#lastPage").val()){
              layer.msg('已经是最后一页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          query(page);
      }
      //点击末页
      function lastPage(){
          var page = $("#lastPage").val();
          if(page == $("#nowPage").val()){
              layer.msg('已经是最后一页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          query(page);
      }
      //跳转到指定页
      function toPage(){
          var page =parseInt($("#toPage").val().trim());

          if(page>$("#lastPage").val()){
              layer.msg('没有那么多页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          if(page<=0){
              layer.msg('页码不能小于1', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          if(page == $("#nowPage").val()){
              layer.msg('已经是第'+page+'页', {
                  icon: 1,
                  time: 1000
              });
              return;
          }
          query(page);
      }


      //查询全部广告
      function query(index){
          if (index==null||index==0){
              index=1;
          }
          var title=$('#title').val();
          var type=$('#type').val();
          var code=$('#code').val();
          var state=$('#state').val();
          var place=$('#place').val();

          $.ajax({
              type: "GET",
              url: "/advert/advertise/query",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data: {
               "index": index
              ,"title":title
              ,"type":type
              ,"code":code
              ,"state":state
              ,"place":place
              },
              async: false,
              success:function(data){
                  $(".adds-list").empty();
                      for(var i = 0; i < data.list.length; i ++){
                          var itemw = $('<div class="col-sm-6 col-md-3 adds-info m-b"></div>');
                          var item1 = '<div class="thumbnail" style="position:relative;height:300px;">'+
                                  '<img class="adds-pic" src="'+data.list[i].ad_pic+'" alt="'+data.list[i].ad_title+'">'+
                                  '<div class="caption">'+
                                  '<h3>'+data.list[i].ad_title+'</h3>'+
                                  '<p>'+data.list[i].ad_brief+'</p>'+
                                  '</div><div style="position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.75); color:#fafafa;font-size:20px; line-height: 250px;text-align:center; border-radius:3px;">未开启</div>'+
                                  '</div><input type="hidden" class="adds-id" value="'+data.list[i].id+'">';

                          var item2 = '<div class="thumbnail" style="position:relative;height:300px;">'+
                                  '<img class="adds-pic" src="'+data.list[i].ad_pic+'" alt="'+data.list[i].ad_title+'">'+
                                  '<div class="caption">'+
                                  '<h3>'+data.list[i].ad_title+'</h3>'+
                                  '<p>'+data.list[i].ad_brief+'</p>'+
                                  '</div>'+
                                  '</div><input type="hidden" class="adds-id" value="'+data.list[i].id+'">';

                          var item = data.list[i].ad_state == 0 ? item1 : item2;

                          itemw.append(item);

                          $(".adds-list").append(itemw);
                          itemw.fadeIn();
                          //分页
                          $("#firstPage").val(1);
                          $("#nowPage").val(data.pageNumber);
                          $("#lastPage").val(data.totalPage);
                          $("#pageInfo").html("共"+data.totalRow+"条数据，当前显示第 "+data.pageNumber+" 页  ，到");
                  }
              }
          })

      }


      //获取频道
      function port(){
          //获取频道端口
          var port=$('#port').val();
          $.ajax({
              type: "GET",
              url: "/advert/advertise/findchannel",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data:{"port":port},
              async: false,
              success:function(data){
                  $("#channel").empty();
                  if (data.length==0){
                      $("#channel").append("<option value=''>此端口下暂无频道</option>");
                  }
                  for (var i=0;i<data.length;i++){
                      $("#channel").append("<option value='"+data[i].id+"'>"+data[i].ch_title+"</option>");
                  }
              }
          });
      };

      //获取广告位
      function findplace(){
          //获取频道id
          var channelid=$('#channel').val();
          $.ajax({
              type: "GET",
              url: "/advert/advertise/findplace",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data:{"channelid":channelid},
              async: false,
              success:function(data){
                  $("#place").empty();
                  if (data.length==0){
                      $("#place").append("<option value=''>此频道下无广告位</option>");
                  }
                  for (var i=0;i<data.length;i++){
                      $("#place").append("<option value='"+data[i].id+"'>"+data[i].pl_title+"</option>");
                  }
              }
          });
      }


      //获取频道
      function port1(){
          //获取频道端口
          var port=$('#port_update').val();
          $.ajax({
              type: "GET",
              url: "/advert/advertise/findchannel",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data:{"port":port},
              async: false,
              success:function(data){
                  $("#channel_update").empty();
                  if (data.length==0){
                      $("#channel_update").append("<option value=''>此端口下暂无频道</option>");
                  }
                  for (var i=0;i<data.length;i++){
                      $("#channel_update").append("<option value='"+data[i].id+"'>"+data[i].ch_title+"</option>");
                  }
              }
          });
      };

      //获取广告位
      function findplace1(){
          //获取频道id
          var channelid=$('#channel_update').val();
          $.ajax({
              type: "GET",
              url: "/advert/advertise/findplace",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data:{"channelid":channelid},
              async: false,
              success:function(data){
                  $("#pl_id_update").empty();
                  if (data.length==0){
                      $("#pl_id_update").append("<option value=''>此频道下无广告位</option>");
                  }
                  for (var i=0;i<data.length;i++){
                      $("#pl_id_update").append("<option value='"+data[i].id+"'>"+data[i].pl_title+"</option>");
                  }
              }
          });
      }


      //通过图片名称搜索图片
      function findfile(){
          //获取图片名称
          var filename=$("#filename").val();
          if (filename==""){
              $("#flieinfo").empty();
              return;
          }
          $.ajax({
              type: "GET",
              url: "/advert/advertise/findfile",
              dataType: "json",
              contentType: "application/json; charset=utf-8",
              data:{"filename":filename},
              async: false,
              success:function(data){
                  $("#flieinfo").empty();
                  var txt="";
                  for (var i=0;i<data.length;i++){
                      txt+="<li onclick='clickimginfo(this)'> <img src='"+data[i].file_address+"'/> <span>"+data[i].file_address+"</span> </li><input type='hidden' value='"+data[i].id+"'/>"
                  }
                  $("#flieinfo").append(txt);
              }
          })
      }


      function clickimginfo(data){
          //图片id $(data).next().val()
          $('#filename').val($(data).find('span').html());
          $("#flieinfo").empty();
      }

    $(document).ready(function () {
        //图片框处理
        $('#filename').keyup(function(){
            setTimeout(findfile(),1000);
        });

        //查询广告位联动模块
        port();
        findplace();
        //查询城市联动模块
        firstregion();
        //查询全部数据
        query();

        $('#port').change(function(){
            port();
            findplace();
        });
        $('#channel').change(function(){
            findplace();
        });

        $('#province').change(function(){
            secondregion();
            thirdregion();
            var code=$("#province").val();
            $('#code').val(code);
        })
        $('#city').change(function(){
            thirdregion();
            var code=$("#city").val();
            $('#code').val(code);
        })

        $('#country').change(function(){
            var code=$("#country").val();
            $('#code').val(code);
        })


      });


      /**
       * 城市联动模块JS
       */
      function secondregion(){
          if ($("#province").val()=='00'){
              $("#city").empty();
              $("#city").append('<option value="">===市===</option>');
              $("#city").val('');
              $("#country").empty();
              $("#country").append('<option value="">===县===</option>');
              $("#country").val('');
              return;
          }
          var ajaxdatas ="code="+$("#province").val();
          $.ajax({
              type : "GET",
              url : "/advert/advertise/secondRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              data:ajaxdatas,
              async: false,
              success : function(data) {
                  if(data.code=="0000"){
                      $("#city").empty();

                      var list =data.data;
                      $("#city").append('<option value="">===市===</option>');
                      $.each(list,function(i,item){

                          var icode =item.code;
                          var iregion =item.region;

                          $("#city").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };
      function thirdregion(){
          var ajaxdatas ="code="+$("#city").val();
          $.ajax({
              type : "GET",
              url : "/advert/advertise/thirdRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              data:ajaxdatas,
              async: false,
              success : function(data) {

                  if(data.code=="0000"){
                      $("#country").empty();
                      $("#country").append('<option value="">===县===</option>');
                      var list =data.data;
                      $.each(list,function(i,item){
                          var icode =item.code;
                          var iregion =item.region;
                          $("#country").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };
      function firstregion(){
          $.ajax({
              type : "GET",
              url : "/advert/advertise/firstRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              async: false,
              success : function(data) {

                  if(data.code=="0000"){
                      $("#province").empty();
                      var list =data.data;
                      $.each(list,function(i,item){

                          var icode =item.code;
                          var iregion =item.region;

                          $("#province").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };



      //修改(城市联动模块)
      /**
       * 城市联动模块JS
       */
      function secondregion1(){
          if ($("#province1").val()=='00'){
              $("#city1").empty();
              $("#city1").append('<option value="">===市===</option>');
              $("#city1").val('');
              $("#country1").empty();
              $("#country1").append('<option value="">===县===</option>');
              $("#country1").val('');
              return;
          }
          var ajaxdatas ="code="+$("#province1").val();
          $.ajax({
              type : "GET",
              url : "/advert/advertise/secondRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              data:ajaxdatas,
              async: false,
              success : function(data) {
                  if(data.code=="0000"){
                      $("#city1").empty();

                      var list =data.data;
                      $("#city1").append('<option value="">===市===</option>');
                      $.each(list,function(i,item){

                          var icode =item.code;
                          var iregion =item.region;

                          $("#city1").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };
      function thirdregion1(){
          var ajaxdatas ="code="+$("#city1").val();
          $.ajax({
              type : "GET",
              url : "/advert/advertise/thirdRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              data:ajaxdatas,
              async: false,
              success : function(data) {

                  if(data.code=="0000"){
                      $("#country1").empty();
                      $("#country1").append('<option value="">===县===</option>');
                      var list =data.data;
                      $.each(list,function(i,item){

                          var icode =item.code;
                          var iregion =item.region;
                          $("#country1").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };
      function firstregion1(){
          $.ajax({
              type : "GET",
              url : "/advert/advertise/firstRegion",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              async: false,
              success : function(data) {
                  if(data.code=="0000"){
                      $("#province1").empty();
                      var list =data.data;
                      $.each(list,function(i,item){

                          var icode =item.code;
                          var iregion =item.region;

                          $("#province1").append("<option value='"+icode+"'>"+iregion+"</option>");
                      })

                  }else{
                      alert(data.data);
                  }
              }
          })
      };



      //修改跳转链接地址
      function updateval1(){
          //获取type类型
          var val="";
          switch ($('#type_update').val()){
              case '1':
                  val="manjiwang://push/goodsdetail?articleid=";
                  break;
              case '2':
                  val="manjiwang://push/shopdetail?shoptype=1&shopid=";
                  break;
              case '3':
                  val="manjiwang://push/shopdetail?shoptype=2&shopid=";
                  break;
              case '4':
                  val="manjiwang://push/shopdetail?shoptype=3&shopid=";
                  break;
              case '5':
                  val="manjiwang://push/shopdetail?shoptype=4&shopid=";
                  break;
              case '6':
                  val="manjiwang://push/web?url=";
                  break;
              case '10':
                  val="manjiwang://push/searchshop?key=";
                  break;
              case '11':
                  val="manjiwang://push/searchgoods?type=goods&key=";
                  break;
              case '12':
                  val="manjiwang://push/searchgoods?type=shops&key=";
                  break;
              default:
                  val="";
          }
          $('#val_update').val(val);
      }

      $(function(){
      /**
       * 修改模块js
       */
      $("#adds-update").click(function(){
          var id = $("#addsId").val();
          $.ajax({
              type : "GET",
              url : "/advert/advertise/update",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              async: false,
              data : {
                  id: id
              },
              success : function(data) {
                      $("#addsId").val(data.id);
                      $("#title_update").val(data.ad_title);
                      $("#brief_update").val(data.ad_brief);

                      //查询广告位模块
                       port1();
                      $("#port_update").val(data.port);
                      $("#channel_update").val(data.channel_id);
                      findplace1();
                      $("#pl_id_update").val(data.ad_place);
                      $("#sort_update").val(data.ad_sort);
                      $('#filename').val(data.ad_pic);


                      //查询城市联动模块

                     firstregion1();
                     //给城市赋上对应值

                     for (var i=0;i<data.codeNameList.length;i++){
                        switch (i){
                            case 0:
                                $("#province1").val(data.codeNameList[i].code);
                                secondregion1();
                                thirdregion1();
                                var region=$("#province1").find("option:selected").text();
                                var code=$("#province1").val();
                                $('#region-update').val(region);
                                $('#code-update').val(code);
                                break;
                            case 1:
                                $("#city1").val(data.codeNameList[i].code);
                                thirdregion1();
                                var region=$("#province1").find("option:selected").text()+$("#city1").find("option:selected").text();
                                var code=$("#city1").val();
                                $('#region-update').val(region);
                                $('#code-update').val(code);
                                break;
                            case 2:
                                $("#country1").val(data.codeNameList[i].code);
                                var region=$("#province1").find("option:selected").text()+$("#city1").find("option:selected").text()+$("#country1").find("option:selected").text();
                                var code=$("#country1").val();
                                $('#region-update').val(region);
                                $('#code-update').val(code);
                                break;
                        }

                     }


                      //判断广告类型
                      switch (data.ad_type){
                          case '1': $("#type_update").val('1');
                              break;
                          case '2': $("#type_update").val('2');
                              break;
                          case '3': $("#type_update").val('3');
                              break;
                          case '4': $("#type_update").val('4');
                              break;
                          case '5': $("#type_update").val('5');
                              break;
                          case '6': $("#type_update").val('6');
                              break;
                          case '7': $("#type_update").val('7');
                              break;
                          case '8': $("#type_update").val('8');
                              break;
                          case '9': $("#type_update").val('9');
                              break;
                      }
                  }

          });
          $("#showDetail").modal('hide');
          $("#showUpdate").modal('show');
      });


          //类型修改时
          $('#type_update').change(function(){
              updateval1();
          });

          $('#port_update').change(function(){
              port1();
              findplace1();
          });
          $('#channel_update').change(function(){
              findplace1();
          });

          //点击联动时
          $('#province1').change(function(){
              secondregion1();
              thirdregion1();
              var region=$("#province1").find("option:selected").text();
              var code=$("#province1").val();
              $('#region-update').val(region);
              $('#code-update').val(code);
          })
          $('#city1').change(function(){
              thirdregion1();
              var region=$("#province1").find("option:selected").text()+$("#city1").find("option:selected").text();
              var code=$("#city1").val();
              $('#region-update').val(region);
              $('#code-update').val(code);
          })

          $('#country1').change(function(){
              var region=$("#province1").find("option:selected").text()+$("#city1").find("option:selected").text()+$("#country1").find("option:selected").text();
              var code=$("#country1").val();
              $('#region-update').val(region);
              $('#code-update').val(code);
          });

          //详情窗js
      $('.adds-list').on("click",'.thumbnail',function(){
          var id = $(this).siblings('.adds-id').val();

          $.ajax({
              type : "GET",
              url : "/advert/advertise/change",
              dataType : "json",
              contentType : "application/json; charset=utf-8",
              data : {
                  id: id
              },
              success : function(data) {
                      var picBox = $(".pic-box");

                      $("#addsId").val(data.id);
                      $("#title_detail").val(data.ad_title);
                      $("#brief_detail").val(data.ad_brief);
                      $("#pl_id_detail").val(data.pl_title);
                      $("#region_detail").val(data.ad_region);
                      $("#count_detail").val(data.count);

                      $("#region-update").val(data.ad_region);
                      $("#code-update").val(data.ad_code);
                      $("#val_update").val(data.ad_value);
                      $("#channel_detail").val(data.port);
                      $('#sort').val(data.ad_sort);


                      //判断广告类型
                      switch (data.ad_type){
                          case '1': $("#type_detail").val('商品');
                              break;
                          case '2': $("#type_detail").val('商家-日用百货');
                              break;
                          case '3': $("#type_detail").val('商家-餐饮美食');
                              break;
                          case '4': $("#type_detail").val('商家-酒店住宿');
                              break;
                          case '5': $("#type_detail").val('商家-其他');
                              break;
                          case '6': $("#type_detail").val('活动');
                              break;
                          case '7': $("#type_detail").val('导航');
                              break;
                          case '8': $("#type_detail").val('图片');
                              break;
                          case '9': $("#type_detail").val('文字');
                              break;
                      }

                     //判断状态开关
                      if(data.ad_state == 0){
                          $("#switchery").removeAttr("checked");
                          $("#switchery").siblings().remove();
                          var elem = document.querySelector('.stateCheck');
                          var switchery = new Switchery(elem, {
                              color: '#1AB394'
                          });
                      }else{
                          $("#switchery").prop("checked",'true');
                          $("#switchery").siblings().remove();
                          var elem = document.querySelector('.stateCheck');
                          var switchery = new Switchery(elem, {
                              color: '#1AB394'
                          });
                      }

                      //图片链接
                         picBox.empty();
                          var pic = '<div class="col-sm-2">'+
                                  '<a href="'+data.ad_pic+'" target="_blank" class="thumbnail">'+
                                  '<img style="width:60px; height:60px;" src="'+data.ad_pic+'">'+
                                  '</a>'+
                                  '</div>';
                          picBox.append(pic);



                      $("#showDetail").modal('show');
                  }
          });
      });

        //修改状态
          $('.stateCheck').change(function(){
              var state = $(this).is(':checked') ? 1 : 0;
              var id = $("#addsId").val();
              $.ajax({
                  type : "GET",
                  url : "/advert/advertise/updateState",
                  dataType : "json",
                  contentType : "application/json; charset=utf-8",
                  data : {
                      id: id,
                      state: state
                  },
                  success : function(data) {
                      //修改成功
                      if (data>0){
                          //目前这里是修改完成以后，直接加载所有的广告数据，这样不好是因为之前查询的时候选择了查询条件，现在修改了查询条件还存在，但是数据却显示的是所有的数据
                          //获取当前页
                          var page=$('#nowPage').val();
                          query(page);
                      }
                  }
              })
          })

      });


  </script>



#end