#@layout() 
#define main()

 <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>广告浏览总量</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="/advert/toMain">主页</a>
                        </li>
                        <li>
                            <strong>广告浏览总量</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">
    
                </div>
            </div>
            
            
            
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            
                            <div class="row adds-header ibox-content form-horizontal">
                                <div class="row adds-header form-horizontal">
                                	<div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" for="state">广告状态：</label>
							              <div class="col-sm-6">
							                <select id="state" class="form-control">
							                  <option value="">不限</option>
							                  <option value="1">开启</option>
							                  <option value="0">关闭</option>
							                </select>
							              </div>
							            </div>
							        </div>
							        <div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" for="type">广告类型：</label>
							              <div class="col-sm-6">
							               <!--  -->
							               <select id="type" class="form-control" >
							                  <option value="">不限</option>
							                  <option value="1">商品</option>
							                  <option value="2">商家-日用百货</option>
							                  <option value="3">商家-餐饮美食</option>
							                  <option value="4">商家-酒店住宿</option>
							                  <option value="5">商家-其他</option>
							                  <option value="6">活动</option>
							                  <option value="7">导航</option>
							                  <option value="8">图片</option>
							                  <option value="9">文字</option>
							                </select>
							              </div>
							            </div>
							          </div>
							          <div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" for="title">广告标题：</label>
							              <div class="col-sm-6">
							                <input type="text"  class="form-control" id="title" placeholder="广告标题"> 
							              </div>
							            </div>
							          </div>
							         <div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" >频道端口：</label>
							              <div class="col-sm-6">
							                <select class="form-control" required="required" id="port">
							                  <option value="">不限</option>
							                  <option value="APP">APP</option>
							                 <option value="PC">PC</option>
							                </select>
							              </div>
							            </div>
							        </div>
                                    <div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" for="channel">频道：</label>
							              <div class="col-sm-6">
							                <select id="channel" class="form-control">
							                  <option value="">不限</option>
							                </select>
							              </div>
							            </div>
							          </div>
							          <div class="col-sm-4">
							            <div class="form-group">
							              <label class="col-sm-4 control-label" for="place">广告位：</label>
							              <div class="col-sm-6">
							                <select id="place" class="form-control">
							                  <option value="">不限</option>
							                </select>
							              </div>
							            </div>
							          </div>
							          <div class="col-sm-8">
							            <div class="form-group">
							              <label class="col-sm-2 control-label">投放区域：</label>
							              <div class="col-sm-10 row">
							                <div class="col-sm-4">
							                  <select class="form-control" required="required" id="province">
							                    <option value="">====省===</option>
							                  </select>
							                </div>
							                <div class="col-sm-4">
							                  <select class="form-control" id="city">
							                    <option value="">===市===</option>
							                  </select>
							                </div>
							                <div class="col-sm-4">
							                  <select class="form-control" id="country">
							                    <option value="">===县===</option>
							                  </select>
							                </div>
							                <input type="hidden" class="form-control" name="code" id="hiddencode">
							              </div>
							            </div>
							        </div>
                                    <div class="col-sm-2">
                                        <button type="button" id="searchPl" class="btn btn-primary pull-right" onclick="selStatic(1)">查询</button>
                                        <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newPlace">新增</button> -->
                                    </div>
                                </div>
                                
                                <table class="table table-striped table-bordered table-hover " >
                                    <thead>
                                        <tr>
                                            <th>编号</th>
                                            <th>标题</th>
                                            <th>投放区域</th>
                                            <th>链接地址</th>
                                            <th>广告描述</th>
                                            <th>广告类型</th>
                                            <th>广告位</th>
                                            <th>时间</th>
                                            <th>状态</th>
                                            <th>点击量</th>
                                            <th>浏览量</th>
                                        </tr>
                                    </thead>
                                    <tbody id="placeList">
                                       
                                    </tbody>
                                </table>

                            </div>
                            <div class="row adds-header ibox-content form-horizontal">
                            	<div class="pull-left">
									<span id="pageInfo"></span>
									<input class="page_number" type="text" value="1" id="toPage" style="width:48px;height: 34px; text-align: center; border:1px solid #31AD8B; border-radius:4px;"/>&nbsp
									<button class="btn btn-primary pull-right" onclick="toPage()">GO</button>
								</div>	
								<div class="pull-right">
									<input id="firstPage" type="hidden"/>
									<input id="nowPage" type="hidden"/>
									<input id="lastPage" type="hidden"/>
									<a class="page_btn btn btn-primary" onclick="firstPage()">首页</a>
									<a class="page_btn btn btn-primary" onclick="upPage()">上一页</a>
									<a class="page_btn btn btn-primary" onclick="nextPage()">下一页</a>
									<a class="page_btn btn btn-primary" onclick="lastPage()">尾页</a>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Mainly scripts -->
    <script src="#(ctx)/static/js/jquery-2.1.1.min.js"></script>
    <script src="#(ctx)/static/js/bootstrap.min.js"></script>
    <script src="#(ctx)/static/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <!-- Data Tables -->
    <script src="#(ctx)/static/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="#(ctx)/static/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <!-- Custom and plugin javascript -->
    <script src="#(ctx)/static/js/hplus.js?v=2.2.0"></script>
    <script src="#(ctx)/static/js/plugins/pace/pace.min.js"></script>
    <!-- layer javascript -->
    <script src="#(ctx)/static/js/plugins/layer/layer.min.js"></script>
		
  <script>
    $(document).ready(function () {
    	//查询广告位联动模块
        port();
        findplace();
        //查询城市联动模块
        firstregion();
        //查询全部数据
    	selStatic(1);
    	
    	$('#port').change(function(){
            port();
            findplace();
        });
        $('#channel').change(function(){
            findplace();
        });
        $('#province').change(function(){
            secondregion();
            thirdregion();
            var code=$("#province").val();
            $('#code').val(code);
        })
        $('#city').change(function(){
            thirdregion();
            var code=$("#city").val();
            $('#code').val(code);
        })

        $('#country').change(function(){
            var code=$("#country").val();
            $('#code').val(code);
        })

    });
    function selStatic(page){
      	var state="";
      	var type="";
      	var title="";
      	var place="";
      	var region="";
      	
    	if($("#state").val()!=""){
      		state=$("#state").val();
      	}
    	if($("#type").val()!=""){
    		type=$("#type").val();
      	}
    	if($("#title").val()!=""){
    		title=$("#title").val();
      	}
    	if($("#place").val()!=""){
    		place=$("#place").val();
      	}
    	if($("#province").val()!="00"){
    		region=$("#province").find("option:selected").text()+$("#city").find("option:selected").text()+$("#country").find("option:selected").text();
      	}
    	$.ajax({
			type:"get",
			url:"/advert/index/clickInfoAll",
			dataType:"json",
			data:{
				state:state,
				type:type,
				title:title,
				place:place,
				region:region,
				page:page
			},success:function(data){
				var txt="";
				if(data.list.length>0){
					$(data.list).each(function(){
						
						var ad_type = "";
						
					    switch(parseInt(this.ad_type)){
					        case 1:
					        	ad_type = "商品";
					        break;
					        
					        case 2:
					        	ad_type = "商家-日用百货";
					        break;
					        
					        case 3:
					        	ad_type = "商家-餐饮美食";
					        break;
					        
					        case 4:
					        	ad_type = "商家-酒店住宿";
					        break;
					        
					        case 5:
					        	ad_type = "商家-其他";
					        break;
					        
					        case 6:
					        	ad_type = "活动";
					        break;
					        
					        case 7:
					        	ad_type = "导航";
					        break;
					        
					        case 8:
					        	ad_type = "图片";
					        break;
					        
					        case 9:
					        	ad_type = "文字";
					        break;
					        
					        default:
					        	ad_type = "";
					        break;
					    }
					    
					    var ad_state = "";
						
					    switch(parseInt(this.ad_state)){
					        case 1:
					        	ad_state = "开启";
					        break;
					        
					        case 0:
					        	ad_state = "关闭";
					        break;
					        
					        default:
					        	ad_state = "";
					        break;
					    }
						
	   					txt +="<tr><td>"
	   							+this.temprownumber+
	   							"</td><td>"
	   							+this.ad_title+
	   							"</td><td>"
	   							+this.ad_region+
	   							"</td><td>"
	   							+this.ad_value+
	   							"</td><td>"
	   							+this.ad_brief+
	   							"</td><td>"
	   							+ad_type+
	   							"</td><td>"
	   							+this.pl_title+
	   							"</td><td>"
	   							+this.ad_ctime+
	   							"</td><td>"
	   							+ad_state+
	   							"</td><td>"
	   							+this.ad_click+
	   							"</td><td>"
	   							+this.ad_view+
	   							"</td></tr>";
					});
					$("#placeList").html(txt);
    				$("#firstPage").val(1);
    				$("#nowPage").val(data.pageNumber);
    				$("#lastPage").val(data.totalPage);
    				$("#pageInfo").html("共"+data.totalRow+"条数据，当前显示第 "+data.pageNumber+" 页  ，到");
				}else{
					layer.msg('查无数据！', {
        				icon: 1,
        				time: 1000
        			});
				}
			}
			
		});
    }
    
    
  //获取频道
    function port(){
        //获取频道端口
        var port=$('#port').val();
        $.ajax({
            type: "GET",
            url: "/advert/advertise/findchannel",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data:{"port":port},
            async: false,
            success:function(data){
                $("#channel").empty();
                if (data.length==0){
                    $("#channel").append("<option value=''>此端口下暂无频道</option>");
                }
                for (var i=0;i<data.length;i++){
                    $("#channel").append("<option value='"+data[i].id+"'>"+data[i].ch_title+"</option>");
                }
            }
        });
    };
    
    //获取广告位
    function findplace(){
        //获取频道id
        var channelid=$('#channel').val();
        $.ajax({
            type: "GET",
            url: "/advert/advertise/findplace",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data:{"channelid":channelid},
            async: false,
            success:function(data){
                $("#place").empty();
                if (data.length==0){
                    $("#place").append("<option value=''>此频道下无广告位</option>");
                }
                for (var i=0;i<data.length;i++){
                    $("#place").append("<option value='"+data[i].id+"'>"+data[i].pl_title+"</option>");
                }
            }
        });
    }
    
    /**
     * 城市联动模块JS
     */
    function secondregion(){
        if ($("#province").val()=='00'){
            $("#city").empty();
            $("#city").append('<option value="">===市===</option>');
            $("#city").val('');
            $("#country").empty();
            $("#country").append('<option value="">===县===</option>');
            $("#country").val('');
            return;
        }
        var ajaxdatas ="code="+$("#province").val();
        $.ajax({
            type : "GET",
            url : "/advert/advertise/secondRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            data:ajaxdatas,
            async: false,
            success : function(data) {
                if(data.code=="0000"){
                    $("#city").empty();
                    var list =data.data;
                    $("#city").append('<option value="">===市===</option>');
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#city").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };
    function thirdregion(){
        var ajaxdatas ="code="+$("#city").val();
        $.ajax({
            type : "GET",
            url : "/advert/advertise/thirdRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            data:ajaxdatas,
            async: false,
            success : function(data) {

                if(data.code=="0000"){
                    $("#country").empty();
                    $("#country").append('<option value="">===县===</option>');
                    var list =data.data;
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#country").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };
    function firstregion(){
        $.ajax({
            type : "GET",
            url : "/advert/advertise/firstRegion",
            dataType : "json",
            contentType : "application/json; charset=utf-8",
            async: false,
            success : function(data) {

                if(data.code=="0000"){
                    $("#province").empty();
                    var list =data.data;
                    $.each(list,function(i,item){

                        var icode =item.code;
                        var iregion =item.region;

                        $("#province").append("<option value='"+icode+"'>"+iregion+"</option>");
                    })

                }else{
                    alert(data.data);
                }
            }
        })
    };

	/****************分页********************/
	  //点击首页
		function firstPage(){
			if(1 == $("#nowPage").val()){
				layer.msg('已经是第一页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			selStatic(1);
		}
		//点击上一页
		function upPage(){
			var page = $("#nowPage").val()*1-1;
			if(page<1){
				layer.msg('已经是第一页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			selStatic(page);
		}
		//点击下一页
		function nextPage(){
			var page = $("#nowPage").val()*1+1;
			if(page>$("#lastPage").val()){
				layer.msg('已经是最后一页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			selStatic(page);
		}
		//点击末页
		function lastPage(){
			var page = $("#lastPage").val();
			if(page == $("#nowPage").val()){
				layer.msg('已经是最后一页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			selStatic(page);
		}
		//跳转到指定页
		function toPage(){   
			var page =parseInt($("#toPage").val().trim());

			if(page>$("#lastPage").val()){
				layer.msg('没有那么多页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			if(page<=0){
				layer.msg('页码不能小于1', {
					icon: 1,
					time: 1000
				});
				return;
			}
			if(page == $("#nowPage").val()){
				layer.msg('已经是第'+page+'页', {
					icon: 1,
					time: 1000
				});
				return;
			}
			selStatic(page);
		}
			
  </script>
#end