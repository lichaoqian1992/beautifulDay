package com.manji.sheet.controller;

import java.util.List;

import com.jfinal.core.Controller;
import com.jfinal.plugin.activerecord.Record;
import com.manji.sheet.service.BaseService;
import com.manji.sheet.utils.WorkerNumberUtil;
/**
 * 基础配置控制层
 * @author Administrator
 *
 */
public class BaseController extends Controller{

	BaseService service = new BaseService();
	
	/**
	 * 查询所有工单层级为1 的工单类型
	 */
	public void findSheetType(){
		
		List<Record> list = service.findSheetType();
		renderJson(list);
		
	}
	/**
	 * 根据工单类型的code查询下面的子分类
	 */
	@SuppressWarnings("static-access")
	public void findSheetTypeByCode(){
		
		String code = getPara("code");
		List<Record> list = new WorkerNumberUtil().getcodeReport(code);
		renderJson(list);
		
	}
	/**
	 * 根据工单类型编号禁用或者启用工单类型
	 */
	public void disable(){
		String message = "";
		int id = getParaToInt("id");
		int status = getParaToInt("status");
		int num = service.disable(id, status,"dt_sheet_type");
		if(num > 0 ){
			message = "SUCCESS";
		}else{
			message = "ERROR";
		}
		setAttr("message", message);
		renderJson();
	}

	/**
	 * 新增举报类型
	 */
	public void addSheetType(){
		String code = getPara("code");
		String title = getPara("title");
		int sort = getParaToInt("sort");
		Boolean flag = service.addSheetType(code, title, sort);
		if(flag){
			setAttr("message", "SUCCESS");
		}else{
			setAttr("message", "FAIL");
		}
		renderJson();
	}
	/**
	 * 修改举报类型
	 */
	public void updateSheetType(){
		
		int id = getParaToInt("id");
		String title = getPara("title");
		int sort = getParaToInt("sort");
		int num = service.updateSheetType(id, title, sort);
		if(num > 0){
			setAttr("message", "SUCCESS");
		}else{
			setAttr("message", "FAIL");
		}
		renderJson();
	}
	/**
	 * 查询部门信息
	 */
	public void findDept(){
		
		int status = getParaToInt("status");
		String type = getPara("type"); 
		String name = getPara("name");
		List<Record> list = service.findDept(status,type,name);
		renderJson(list);
	}
	/**
	 * 禁用或启用部门
	 */
	public void isDone(){
		String message = "";
		int id = getParaToInt("id");
		int status = getParaToInt("status");
		int num = service.disable(id, status,"dt_sheet_dept");
		if(num > 0 ){
			message = "SUCCESS";
		}else{
			message = "ERROR";
		}
		setAttr("message", message);
		renderJson();
	}
}
