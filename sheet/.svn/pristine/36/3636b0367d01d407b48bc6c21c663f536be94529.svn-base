 #@pclayout() #define main()
		<!--描述：页面内容部分-->
		<div class="kf_content_box">
			<div class="kf_bg_box">
				<div class="kf_nav">
					<a class="kf_nav_home kf_nav_item">首页</a>
					<span class="kf_nav_item">工单管理</span>
					<span class="kf_nav_item">工单受理</span>
					<span class="kf_nav_item kf_nav_item_last">新增工单</span>
				</div>
				<form action="InsertWorkNumber" enctype="multipart/form-data" method="POST">
					<div class="kf_box">
						<div class="kf_form_box">
							<div class="kf_group_box kf_select_change">
								<div class="kf_group active">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>工单类型</span>
									<div class="kf_group_content">
										<select class="kf_form_text" name="insertOrder.codeType">
											<option value="04">咨讯</option>
										</select>
									</div>
								</div>
								<div class="kf_group active">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>咨讯类型</span>
									<div class="kf_group_content">
										<select class="kf_form_text" name="insertOrder.childType">
										#for(x : code)
											<option value="#(x.code)">#(x.merge_title)</option>
										#end
										</select>
									</div>
								</div>
								<div class="kf_group active">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>缓急程度</span>
									<div class="kf_group_content">
										<select class="kf_form_text" name="insertOrder.priorityLevel" style="width: 178px;">
											<option value="1">一般</option>
											<option value="2">急</option>
											<option value="3">加急</option>
										</select>
									</div>
								</div>
							</div>
							<div class="kf_group_box">
								<div class="kf_group">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>发起人</span>
									<div class="kf_group_content">
										<input class="kf_form_text" type="text" placeholder="请输入发起人" name="insertOrder.username" required="required"/>
									</div>
								</div>
								<div class="kf_group">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>发起人类型</span>
									<div class="kf_group_content">
										<select class="kf_form_text" name="insertOrder.nameType" >
											<option value="1">商家</option>
											<option value="2">媒体</option>
											<option value="3">用户</option>
											<option value="4">政府</option>
											<option value="5">代理商</option>
											<option value="9">其它</option>
										</select>
									</div>
								</div>
								<div class="kf_group">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>发起人联系方式</span>
									<div class="kf_group_content">
										<input class="kf_form_text" type="text" placeholder="请输入发起人联系方式" name="insertOrder.usermobile" required="required"/>
									</div>
								</div>
							</div>
							<div class="kf_group_box">
								<div class="kf_group">
									<span class="kf_group_title"><i class="kf_color_danger">*</i>详细描述</span>
									<div class="kf_group_content kf_group_text_tips">
										<textarea class="kf_form_text kf_form_text_textarea_length" name="insertOrder.userexplain" required="required" maxlength="500" placeholder="请录入详细信息，最少50个字"></textarea>
										<span class="kf_form_text_number"><i>0</i>/500</span>
									</div>
								</div>
							</div>
							<div class="kf_group_box">
								<div class="kf_group">
									<span class="kf_group_title">上传图片</span>
									<div class="kf_group_content kf_group_text_tips">
										<ul class="kf_upload_img">
											<span id="dd"></span >
						                    <li class="kf_upload_item">
											   <span class="kf_upload_box"></span>
						                       <a class="kf_uploat_item_close kf_hide" href="javascript:void(0);"></a>
											   <input type="file" name="insertOrder.file" id="doc" multiple="multiple"  style="width:150px;" onchange="javascript:setImagePreviews();" accept="image/*" />
						                    </li>
										</ul>
										<span class="kf_form_text_number" style="bottom: 0;right: -35px;"><i class="kf_color_danger">1</i>/5</span>
									</div>
								</div>
							</div>
							<div class="kf_form_footer">
								<button type="button" class="kf_btn kf_btn_workorder_add">提交工单申请</button>
								<button type="button" class="kf_btn kf_btn_workorder_cancel">返 回</button>
							</div>
						</div>
					</div>
				</form>
			</div>

		</div>
		<!--描述：页面内容部分结束-->	
		<div class="kf_mode_content kf_mode_tips">
			<div class="kf_mode_tips_box">
				保存成功
			</div>
		</div>
		<!--描述：页面弹出框-->		
		<div class="kf_mode_box ">
			<div class="kf_mode_shield"></div>
			<div class="kf_mode_content kf_mode_affirm_add">
				<div class="kf_mode_body kf_display_table">
					<div class="kf_display_table_cell">
						<span class="kf_mode_content_icon"></span>
						<p>确认保存？</p>
					</div>
				</div>
				<div class="kf_mode_footer">
					<button class="kf_btn kf_btn_grey kf_mode_btn_close" type="button">取 消</button>
					<button class="kf_btn kf_mode_btn_ok" isclass=".kf_mode_affirm" type="button">确 定</button>
				</div>
			</div>
		</div>
		<!--描述：页面弹出框结束-->	
		#include("../../common/_js.html")
		<script type="text/javascript">
			$(function() {
				//侧边栏
				$(".kf_sidebar").on("click",".kf_sidebar_nav>a",function() {
					var nav_list = $(this).siblings(".kf_sidebar_nav_list");
					//其余隐藏
					nav_list.parent().siblings().find(".kf_sidebar_nav_list").animate({
						"height": "0px"
					}, 500);
					
					//显示
					var len = nav_list.find("li").length;
					var hei = nav_list.find("li").height();
					nav_list.animate({
						"height": hei * len + "px"
					}, 500);
				});
				
				$(".kf_sidebar").on("click", ".kf_sidebar_nav_list a", function() {
					$(".kf_sidebar_nav_list li").removeClass("active");
					$(this).parent().addClass("active");
				});

				//弹出窗
				$(".kf_btn_workorder_add").click(function() {
					if($('input[name="insertOrder.username"]').val()==""){
						$(".kf_mode_tips").find(".kf_mode_tips_box").addClass("kf_mode_tips_error");
	    				$(".kf_mode_tips").show().find(".kf_mode_tips_box").text("发起人不能为空!");
	    				interval = setInterval(function() {
	    	    			$(".kf_mode_content, .kf_mode_shield").hide();
	    	    			clearInterval(interval);
	    	    		}, 1000);
						return;
					}
					if($('input[name="insertOrder.usermobile"]').val()==""){
						$(".kf_mode_tips").find(".kf_mode_tips_box").addClass("kf_mode_tips_error");
	    				$(".kf_mode_tips").show().find(".kf_mode_tips_box").text("发起人联系方式不能为空!");
						interval = setInterval(function() {
			    			$(".kf_mode_content, .kf_mode_shield").hide();
			    			clearInterval(interval);
			    		}, 1000);
						return;
					}
					if($('textarea[name="insertOrder.userexplain"]').val()==""){
						$(".kf_mode_tips").find(".kf_mode_tips_box").addClass("kf_mode_tips_error");
	    				$(".kf_mode_tips").show().find(".kf_mode_tips_box").text("发起人详情描述不能为空!");
						interval = setInterval(function() {
			    			$(".kf_mode_content, .kf_mode_shield").hide();
			    			clearInterval(interval);
			    		}, 1000);
						return;
					}
					
					$(".kf_mode_shield , .kf_mode_affirm_add").show();
					$(".kf_mode_affirm_add .kf_display_table_cell p").text("确认保存？");
				});
				$(".kf_btn_workorder_cancel").click(function() {
					$(".kf_mode_shield , .kf_mode_affirm_add").show();
					$(".kf_mode_affirm_add .kf_display_table_cell p").text("取消保存？");
				});

				//关闭弹出窗
				$(".kf_mode_btn_close").click(function() {
					$(".kf_mode_shield , .kf_mode_content").hide();
				});
				//点击确定
				$(".kf_mode_btn_ok").click(function() {
					$("form").submit();
				});
				
				//详细描述字数
				$(".kf_form_text_textarea_length").keyup(function() {
					var len = $(this).val().length;
					$(this).siblings(".kf_form_text_number").find("i").text(len);
				});

			});
			
			function setImagePreviews(avalue) {

			    var docObj = document.getElementById("doc");

			    var dd = document.getElementById("dd");

			    dd.innerHTML = "";

			    var fileList = docObj.files;

			    for (var i = 0; i < fileList.length; i++) {            

			        dd.innerHTML += "<li class='kf_upload_item'><span class='kf_upload_box'><img id='img" + i + "'  /></span><a class='kf_uploat_item_close' href='javascript:void(0);'></a></li>";

			        var imgObjPreview = document.getElementById("img"+i); 

			        if (docObj.files && docObj.files[i]) {

			            //火狐下，直接设img属性

			            imgObjPreview.style.display = 'block';

			            imgObjPreview.style.width = '120px';

			            imgObjPreview.style.height = '120px';

			            //imgObjPreview.src = docObj.files[0].getAsDataURL();

			            //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式

			            imgObjPreview.src = window.URL.createObjectURL(docObj.files[i]);

			        }

			        else {

			            //IE下，使用滤镜

			            docObj.select();

			            var imgSrc = document.selection.createRange().text;

			            alert(imgSrc)

			            var localImagId = document.getElementById("img" + i);

			            //必须设置初始大小

			            localImagId.style.width = "150px";

			            localImagId.style.height = "180px";

			            //图片异常的捕捉，防止用户修改后缀来伪造图片

			            try {

			                localImagId.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";

			                localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;

			            }

			            catch (e) {

			                alert("您上传的图片格式不正确，请重新选择!");

			                return false;

			            }

			            imgObjPreview.style.display = 'none';

			            document.selection.empty();

			        }

			    }  

			    return true;
			}
		</script>
		
#end