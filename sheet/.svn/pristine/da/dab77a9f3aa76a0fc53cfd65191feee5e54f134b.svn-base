package com.manji.sheet.controller;

import com.jfinal.core.Controller;
import com.jfinal.plugin.activerecord.Record;
import com.manji.sheet.service.PCService;
import com.manji.sheet.utils.DatesUtils;

import java.util.List;


//商家PC接口调用
public class PCController extends Controller{

	PCService service = new PCService();
	
	public void index(){
		
		
	}
	
	
	
	/**
	 * 商家PC详情页面
	 * 根据传入不同的short_title来显示不同页面
	 */
	public void getInformation(){
		
		Integer sponsor_id = getParaToInt("sponsor_id");
		String short_title = getPara("short_title");
		Integer shop_user_id = getParaToInt("shop_user_id");
		String start_time = getPara("start_time");
		String end_time = getPara("end_time");
		Integer status = getParaToInt("status");
		String sheet_no = getPara("sheet_no");

		List<Record> records = service.getInformation(sponsor_id,short_title,shop_user_id,start_time,end_time,status,sheet_no);

		renderJson(records);

	}

	/**
	 * 我要建议详情页
	 */
	public void suggestion() {

		String sheet_no = getPara("sheet_no");
		Integer status = getParaToInt("status");

		//建议信息
		Record sugSheet = service.commonSheet(sheet_no);
		setAttr("sugSheet",sugSheet);

		//详细描述
		List<Record> sugInfo = service.disputeInfo(sheet_no);
		setAttr("sugInfo",sugInfo);

		//判断如果工单状态不为未受理
		if (status != 1) {
			//仲裁结果
			Record sugResult = service.arbResult(sheet_no);
			setAttr("sugResult",sugResult);
		}
	}

	/**
	 * 我要举报详情页
	 */
	public void report(){

		String sheet_no = getPara("sheet_no");
		Integer status = getParaToInt("status");
		String short_title = getPara("short_title");

		//举报的工单信息
		Record reportSheet = service.commonSheet(sheet_no);
		setAttr("reportSheet",reportSheet);

		//要举报的提交资料信息
		List<Record> reportInfo = service.disputeInfo(sheet_no);
		setAttr("reportInfo",reportInfo);

		//仲裁结果
		if (status == 4) {

			Record repResult = service.arbResult(sheet_no);
			setAttr("repResult",repResult);

		}

		renderJson();
	}
	
	
	/**
	 * 添加补充资料
	 */
	public void addInformation(){

		Record record = new Record();
		record.set("sheet_id",getParaToLong("sheet_id"));
		record.set("descr",getPara("descr"));
		record.set("pics",getPara("pics"));
		record.set("add_time", DatesUtils.time());
		record.set("submitter",getPara("submitter"));

		boolean flag = service.addInformation(record);

		renderJson(flag);
	}

	/**
	 * 举报
	 */
	public void report1(){
		
	}
	
	/**
	 * 被举报列表
	 */
	/*public void reportedList(){

		long shop_user_id = getParaToLong("shop_user_id");
		String start_time = getPara("start_time");
		String end_time = getPara("end_time");
		Integer status = getParaToInt("status");
		String sheet_no = getPara("sheet_no");

		List<Record> records = service.reported(shop_user_id,start_time,end_time,status,sheet_no);

		renderJson(records);
		
	}*/
	
	
	/**
	 * 被举报详细信息
	 */
	public void reportedInfo(){

		String sheet_no = getPara("sheet_no");
		Integer status = getParaToInt("status");
		String short_title = getPara("short_title");

		//被举报的工单信息
		Record reportedSheet = service.commonSheet(sheet_no);
		setAttr("reportedSheet",reportedSheet);

		//判断被举报内容
		if (short_title == "RGD") {

			Record repObject = service.aritcle(sheet_no); //获取举报的商品
			setAttr("repObject",repObject);
		}

		//举报者提交资料信息
		List<Record> reportedInfo = service.disputeInfo(sheet_no);
		setAttr("reportInfo",reportedInfo);

		//如果被举报的工单状态已完成
		if (status == 4) {

			//被举报的处罚结果
			Record punish = service.pulish(sheet_no);
			setAttr("punish",punish);

			//被举报的仲裁结果
			Record arbResult = service.arbResult(sheet_no);
			setAttr("arbResult",arbResult);
		}
	}
	
	
	
	
	/**
	 * 评价纠纷详情
	 */
	public void commentList(){

		String sheet_no = getPara("sheet_no");
		Integer status = getParaToInt("status");
		//纠纷的工单信息
		Record commentSheet = service.commonSheet(sheet_no);
		setAttr("commentSheet",commentSheet);

		//商家和用户信息
		Record userInfo = service.userInfo(sheet_no);
		setAttr("userInfo",userInfo);
		Record shopInfo = service.shopInfo(sheet_no);
		setAttr("shopInfo",shopInfo);

		//纠纷详情
		List<Record> commentInfo = service.disputeInfo(sheet_no);
		setAttr("commentInfo",commentInfo);

		//仲裁结果
		if (status == 3 || status ==4){

			Record arb = service.arbResult(sheet_no);
			setAttr("arb",arb);
		}

		//评价详情
		
	}
	
	
	/**
	 * 交易纠纷详情
	 */
	public void tradeList(){
		
		String sheet_no = getPara("sheet_no");
		Integer status = getParaToInt("status");

		//交易纠纷工单信息
		Record tradeSheet = service.commonSheet(sheet_no);
		setAttr("tradeSheet",tradeSheet);

		//交易纠纷内容
		List<Record> tradeInfo = service.disputeInfo(sheet_no);
		setAttr("tradeInfo",tradeInfo);

		//仲裁结果
		if (status == 4) {
			//处罚结果执行
			Record pulishTrade = service.pulish(sheet_no);
			setAttr("pulishTrade",pulishTrade);
			//处罚的商品
			Record articleTrade = service.aritcle(sheet_no);
			setAttr("articleTrade",articleTrade);
			//仲裁结果
			Record arbTrade = service.arbResult(sheet_no);
			setAttr("arbTrade",arbTrade);
		}
	}
	
	
	/**
	 * 工单详情
	 */
	public void detail(){
		
		
		
		
		
	}
	
	
	
	
	
	
}
